//
// Created by ffanon on 20/03/2021.
//
#include "headers/console.h"
#include "headers/utils.h"


CONSOLE_LINE translateMarkup(std::string& line)
{
    CONSOLE_LINE consoleLine;

    consoleLine.sleep = 0;
    consoleLine.withBreak = false;
    consoleLine.isDigit = false;

    std::smatch match;

    std::regex_search(line, match, BREAK_LINE_REGEX);
    if ( !match.empty() )
        line = std::regex_replace(line, BREAK_LINE_REGEX, "");
    consoleLine.withBreak = !match.empty();
    consoleLine.line = line;

    std::regex_search(line, match, DELAY_REGEX);
    if ( !match.empty() )
    {
        std::string message = match.str(1);
        consoleLine.sleep = std::stoi(message);
        line = std::regex_replace(line, DELAY_TO_REPLACE_REGEX, "");
        consoleLine.line = line;
    } else {
        std::regex_search(line, match, DIGIT_REGEX);
        if ( !match.empty() )
        {
            consoleLine.isDigit = true;
            line = std::regex_replace(line, DIGIT_REGEX, "");
            consoleLine.line = line;
        }
    }
    return consoleLine;
}


void writeMarkup(CONSOLE_LINE& markup)
{
    if ( markup.isDigit )
        fakeToType(markup.line, 40, 0, markup.withBreak);
    else
        slowDisplay(markup.line, markup.sleep);

    if ( markup.withBreak )
        std::cout << std::endl;
}